name: "滴滴加油油价爬取"
description: "自动获取滴滴加油APP中的油价信息"
version: "1.0"

prerequisites:
  app:
    package: "com.didi.oil"
    apk_path: "didi_gas.apk"
  device:
    min_android: "7.0"
    required_permissions: ["INTERNET", "ACCESS_FINE_LOCATION"]

steps:
  - name: "检查应用安装"
    action: "check_and_install_app"
    params:
      package: "${prerequisites.app.package}"
      apk_path: "${ASSETS_DIR}/didi_gas.apk"

  - name: "等待并点击安装确认"
    action: "wait_and_click_ocr_text"
    params:
      text: "继续安装"
      timeout: 30
      check_interval: 1
      screenshot_region: [50, 1600, 1030, 2400]
    conditions:
      - type: "step_result"
        step: "检查应用安装"
        value: "need_install"

  - name: "等待安装完成"
    action: "wait_for_app_installed"
    params:
      package: "${prerequisites.app.package}"
      timeout: 60
    conditions:
      - type: "step_result"
        step: "检查应用安装"
        value: "need_install"

  - name: "启动应用"
    action: "start_app"
    params:
      package: "${prerequisites.app.package}"

  - name: "处理启动弹窗直到进入主页面"
    action: "handle_popups_until_target"
    params:
      timeout: 100
      check_interval: 1
      screenshot_region: [0, 0, 1080, 2400]
      target_text: "输入目的地，查找附近加油站"
      popups:
        - name: "协议与规则"
          patterns: ["同意", "协议与规则"]
          action: "click_first"
          priority: 1
        - name: "位置权限"
          patterns: ["仅在使用中允许", "是否允许“滴滴加油”获取模糊定位"]
          action: "click_first"
          priority: 1